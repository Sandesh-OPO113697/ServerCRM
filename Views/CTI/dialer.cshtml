@{
    ViewData["Title"] = "CRM Dialer";
    var phoneNumber = Context.Request.Method == "POST" ? Context.Request.Form["phone"].ToString() : "";

}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">


<nav class="navbar navbar-expand-lg navbar-dark bg-primary px-4">
    <a class="navbar-brand" href="#">📞 CRM Dialer</a>

    <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 d-flex align-items-center gap-2">
            <li class="nav-item d-flex align-items-center">
                <form class="d-flex align-items-center gap-2" method="post" asp-controller="CTI" asp-action="MakeCall">
                    <input type="text" name="phone" value="@phoneNumber" class="form-control form-control-sm" placeholder="Enter mobile number" />
                    <button class="btn btn-success btn-sm" type="submit">📞 Call</button>
                </form>
            </li>

            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="Hold">
                    <button class="btn btn-warning btn-sm" type="submit">⏸ Hold</button>
                </form>
            </li>

            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="Unhold">
                    <button class="btn btn-info btn-sm" type="submit">▶ Unhold</button>
                </form>
            </li>
            <li class="nav-item">
                <form id="conferenceForm" method="post" asp-controller="CTI" asp-action="Conference">
                    <input type="hidden" name="number" id="conferenceNumber" />
                    <button type="button" class="btn btn-secondary btn-sm" id="conferenceButton">👥 Conference</button>
                </form>
            </li>


            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="Merge">
                    <button class="btn btn-dark btn-sm" type="submit"> Merge</button>
                </form>
            </li>
            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="Party">
                    <button class="btn btn-dark btn-sm" type="submit"> Party Delete</button>
                </form>
            </li>
            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="Disconnect">
                    <button class="btn btn-dark btn-sm" type="submit">❌ Disconnect</button>
                </form>
            </li>
            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="Break">
                    
                    <select class="form-select form-select-sm" name="reasonCode" onchange="this.form.submit()">
                        <option disabled selected>⏬ Select Reason</option>
                        <option value="5">🍵 Tea</option>
                        <option value="6">🍽 Lunch</option>
                        <option value="7">📘 Training</option>
                        <option value="8">🕵️ Quality</option>
                        <option value="9">🚻 Bio</option>
                        <option value="26">🧑‍💼 TL Feedback</option>
                    </select>
                </form>
            </li>

            <li class="nav-item">
                <form method="post" asp-controller="CTI" asp-action="AgnetReady">
                    <button class="btn btn-dark btn-sm" type="submit">🕵️ Ready</button>
                </form>
            </li>

        </ul>

        <div class="ms-4 text-white fw-bold d-flex flex-column align-items-end">
            <div>Status: <span id="status" class="badge bg-light text-dark">...</span></div>
           
                <div class="alert alert-info mt-2 mb-0 py-1 px-2 text-dark text-center" style="font-size: 0.875rem;">
                    ✅ Agent login successful.
                </div>
            
        </div>
    </div>
</nav>


<script src="~/js/signalr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/ctihub")
        .build();

    connection.on("ReceiveStatus", function (message) {
        document.getElementById("status").innerText = message;
    });

    connection.start().catch(function (err) {
        return console.error(err.toString());
    });

     document.getElementById('conferenceButton').addEventListener('click', function () {
        Swal.fire({
            title: 'Enter conference number',
            input: 'text',
            inputPlaceholder: 'e.g. 7058053821',
            showCancelButton: true,
            confirmButtonText: 'Join',
            inputValidator: (value) => {
                if (!value) {
                    return 'You must enter a number!';
                }
            }
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('conferenceNumber').value = result.value;
                document.getElementById('conferenceForm').submit();
            }
        });
    });
</script>